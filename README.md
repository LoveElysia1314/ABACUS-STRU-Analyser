# ABACUS-STRU-Analyser

[![Python 3.8+](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

é«˜æ•ˆçš„ ABACUS åˆ†å­åŠ¨åŠ›å­¦è½¨è¿¹åˆ†æå·¥å…· / Efficient ABACUS MD Trajectory Analysis Suite

---

## ğŸ“‹ é¡¹ç›®ç®€ä»‹

ABACUS-STRU-Analyser æ˜¯ä¸“ä¸º ABACUS åˆ†å­åŠ¨åŠ›å­¦è½¨è¿¹è®¾è®¡çš„é«˜æ•ˆæ‰¹é‡åˆ†æå·¥å…·ï¼Œæ”¯æŒä»è½¨è¿¹å‘ç°ã€è§£æã€æŒ‡æ ‡è®¡ç®—åˆ°æ™ºèƒ½é‡‡æ ·ä¸ç»Ÿè®¡åˆ†æçš„å…¨æµç¨‹è‡ªåŠ¨åŒ–ã€‚

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- ğŸ¯ **æ™ºèƒ½é‡‡æ ·ç®—æ³•**ï¼šPower Mean è´ªå¿ƒé‡‡æ ·ï¼Œæ˜¾è‘—æå‡é‡‡æ ·è´¨é‡
- ğŸ“Š **å¤šæ ·æ€§æŒ‡æ ‡ä½“ç³»**ï¼šANNDã€MPDã€RMSDã€Coverage Ratioã€JS Divergence ç­‰
- ğŸ”— **ç›¸å…³æ€§åˆ†æ**ï¼šæ¸©åº¦ã€æ„è±¡ä¸å¤šæ ·æ€§æŒ‡æ ‡çš„ç»Ÿè®¡ç›¸å…³æ€§åˆ†æ
- âš–ï¸ **é‡‡æ ·æ–¹æ³•å¯¹æ¯”**ï¼šæ™ºèƒ½é‡‡æ ·ã€éšæœºé‡‡æ ·ã€å‡åŒ€é‡‡æ ·æ€§èƒ½å¯¹æ¯”
- ğŸš€ **æ‰¹é‡å¹¶è¡Œå¤„ç†**ï¼šè‡ªåŠ¨å‘ç°å¤šä¸ªç³»ç»Ÿï¼Œå¤šè¿›ç¨‹å¹¶è¡Œåˆ†æ
- ğŸ”¥ **æ–­ç‚¹ç»­ç®—**ï¼šç¨‹åºä¸­æ–­åè‡ªåŠ¨æ£€æµ‹è¿›åº¦å¹¶ç»­ç®—ï¼Œé¿å…é‡å¤è®¡ç®—
- ğŸ”„ **è‡ªåŠ¨ DeepMD å¯¼å‡º**ï¼šæ¯ä¸ªä½“ç³»åˆ†æå®Œæˆåè‡ªåŠ¨å¯¼å‡º DeepMD è®­ç»ƒæ•°æ®

---

## âœ¨ ä¸»è¦ç‰¹æ€§

- âš¡ **æ„è±¡å‘é‡åŒ–**ï¼šåŸºäºéæ°¢åŸå­å¯¹è·ç¦»ï¼Œè‡ªåŠ¨å¿½ç•¥æ—‹è½¬/å¹³ç§»/ç¼©æ”¾
- ğŸ§® **PCA é™ç»´**ï¼šä¸»æˆåˆ†åˆ†æç©ºé—´ï¼Œæ‰€æœ‰åˆ†æåœ¨é™ç»´ç©ºé—´è¿›è¡Œ
- ğŸ”¬ **å¤šç‰©ç†é‡èåˆ**ï¼šèƒ½é‡ä¸ PCA åˆ†é‡ç»¼åˆå‘é‡ï¼Œä¿¡æ¯å…¨é¢
- ğŸ¯ **æ™ºèƒ½é‡‡æ ·**ï¼šå¹‚å¹³å‡è·ç¦»æœ€å¤§åŒ–è´ªå¿ƒé‡‡æ ·ç®—æ³•
- ğŸ“Š **å¤šæ ·æ€§æŒ‡æ ‡**ï¼šANNDã€MPDã€RMSDã€Coverage Ratioã€JS Divergence ç­‰
- ğŸ”— **ç›¸å…³æ€§åˆ†æ**ï¼šæ¸©åº¦ã€æ„è±¡ä¸å¤šæ ·æ€§æŒ‡æ ‡çš„ç»Ÿè®¡ç›¸å…³æ€§
- âš–ï¸ **é‡‡æ ·å¯¹æ¯”**ï¼šæ™ºèƒ½é‡‡æ ·ã€éšæœºé‡‡æ ·ã€å‡åŒ€é‡‡æ ·å¤šæ–¹æ³•æ€§èƒ½å¯¹æ¯”
- ğŸš€ **æ‰¹é‡å¹¶è¡Œ**ï¼šè‡ªåŠ¨å‘ç°å¤šä¸ªç³»ç»Ÿï¼Œå¤šè¿›ç¨‹å¹¶è¡Œåˆ†æ
- ğŸ“ **å‚æ•°éš”ç¦»è¾“å‡º**ï¼šè¾“å‡ºç›®å½•è‡ªåŠ¨æŒ‰å‚æ•°ç»„åˆå‘½å
- ğŸ”¥ **çƒ­æ›´æ–°ç»­ç®—**ï¼šç¨‹åºä¸­æ–­åè‡ªåŠ¨æ£€æµ‹è¿›åº¦å¹¶ç»­ç®—
- ğŸ’¾ **å¢é‡ä¿å­˜**ï¼šè¾¹è®¡ç®—è¾¹å†™å…¥ï¼Œæ”¯æŒå®æ—¶æ•°æ®æŒä¹…åŒ–
- ğŸ“ **å‘½ä»¤è¡Œå‹å¥½**ï¼šæ‰€æœ‰å‚æ•°æ”¯æŒé•¿çŸ­é€‰é¡¹

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Python 3.8+
- NumPy â‰¥ 1.25
- Pandas â‰¥ 2.2
- SciPy â‰¥ 1.10
- Scikit-learn â‰¥ 1.3
- DPData â‰¥ 0.2.18

### å®‰è£…ä¾èµ–
```bash
pip install numpy>=1.25 pandas>=2.2 scipy>=1.10 scikit-learn>=1.3 dpdata>=0.2.18
```

### åŸºæœ¬ç”¨æ³•
```bash
# åˆ†æå½“å‰ç›®å½•
python main_abacus_analyser.py

# æŒ‡å®šå‚æ•°åˆ†æ
python main_abacus_analyser.py -r 0.05 -p -0.5 -v 0.90 -w 4

# ç›¸å…³æ€§åˆ†æ
python main_correlation_analyser.py

# é‡‡æ ·æ–¹æ³•å¯¹æ¯”
python sampling_compare_demo.py
```

---

## âš™ï¸ å‚æ•°è¯´æ˜

### ä¸»åˆ†æå™¨å‚æ•°
| å‚æ•° | çŸ­é€‰é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|--------|------|
| --sample_ratio | -r | 0.05 | é‡‡æ ·æ¯”ä¾‹ |
| --power_p | -p | -0.5 | å¹‚å¹³å‡è·ç¦» p å€¼ |
| --pca_variance_ratio | -v | 0.90 | PCA ç´¯è®¡æ–¹å·®è´¡çŒ®ç‡ |
| --workers | -w | -1 | å¹¶è¡Œè¿›ç¨‹æ•° (-1=è‡ªåŠ¨) |
| --output_dir | -o | analysis_results | è¾“å‡ºç›®å½• |
| --search_path | -s | å½“å‰ç›®å½•çˆ¶ç›®å½• | æœç´¢è·¯å¾„ |
| --include_project | -i | False | åŒ…å«é¡¹ç›®è‡ªèº«ç›®å½• |
| --force_recompute | -f | False | å¼ºåˆ¶é‡ç®—ï¼ˆå¿½ç•¥è¿›åº¦ï¼‰ |
| --correlation_analysis | -c | True | å¯ç”¨ç›¸å…³æ€§åˆ†æ |
| --sampling_comparison | -sc | True | å¯ç”¨é‡‡æ ·æ–¹æ³•å¯¹æ¯” |

### ç›¸å…³æ€§åˆ†æå™¨å‚æ•°
| å‚æ•° | çŸ­é€‰é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|--------|------|
| --input | -i | auto | è¾“å…¥ CSV æ–‡ä»¶è·¯å¾„ |
| --output | -o | combined_analysis_results | è¾“å‡ºç›®å½• |
| --no-log-file | - | False | ç¦ç”¨æ—¥å¿—æ–‡ä»¶è¾“å‡º |

---

## ğŸ“ è¾“å‡ºç»“æ„

```
analysis_results/
â””â”€â”€ run_r0.1_p-0.5_v0.9/           # å‚æ•°ç»„åˆå‘½åç›®å½•
    â”œâ”€â”€ analysis_targets.json      # åˆ†æç›®æ ‡ç³»ç»Ÿåˆ—è¡¨
    â”œâ”€â”€ combined_analysis_results/ # æ±‡æ€»ç»“æœ
    â”‚   â”œâ”€â”€ system_metrics_summary.csv
    â”‚   â”œâ”€â”€ parameter_analysis_results.csv
    â”‚   â”œâ”€â”€ sampling_methods_comparison.csv
    â”‚   â””â”€â”€ progress.json
    â”œâ”€â”€ single_analysis_results/   # å•ä½“ç³»ç»“æœ
    â”‚   â”œâ”€â”€ frame_metrics_*.csv
    â”‚   â””â”€â”€ sampling_compare_enhanced.csv
    â”œâ”€â”€ mean_structures/           # å¹³å‡ç»“æ„æ•°æ®
    â”‚   â”œâ”€â”€ index.json
    â”‚   â””â”€â”€ mean_structure_*.json
    â””â”€â”€ deepmd_npy_per_system/     # DeepMD æ•°æ®é›†
        â”œâ”€â”€ system_name_1/
        â”‚   â”œâ”€â”€ type.raw
        â”‚   â”œâ”€â”€ set.000/
        â”‚   â””â”€â”€ split_*/
        â””â”€â”€ system_name_2/
            â”œâ”€â”€ type.raw
            â”œâ”€â”€ set.000/
            â””â”€â”€ split_*/
```

### ä¸»è¦è¾“å‡ºæ–‡ä»¶

- **system_metrics_summary.csv**ï¼šç³»ç»Ÿçº§æŒ‡æ ‡æ±‡æ€»
- **parameter_analysis_results.csv**ï¼šç›¸å…³æ€§åˆ†æç»“æœ
- **frame_metrics_*.csv**ï¼šå•ä½“ç³»å¸§çº§æŒ‡æ ‡
- **sampling_methods_comparison.csv**ï¼šé‡‡æ ·æ–¹æ³•å¯¹æ¯”æ±‡æ€»
- **progress.json**ï¼šåˆ†æè¿›åº¦è·Ÿè¸ªï¼ˆæ–­ç‚¹ç»­ç®—ï¼‰
- **mean_structure_*.json**ï¼šå¹³å‡ç»“æ„æ•°æ®
- **deepmd_npy_per_system/**ï¼šæŒ‰ä½“ç³» DeepMD æ•°æ®é›†ç›®å½•

---

## ğŸ§® æ ¸å¿ƒç®—æ³•

### å¤šæ ·æ€§ä¸è·ç¦»æŒ‡æ ‡
- **ANND**ï¼šå¹³å‡æœ€è¿‘é‚»è·ç¦»
- **MPD**ï¼šå¹³å‡æˆå¯¹è·ç¦»
- **RMSD**ï¼šç»å…¸å‡æ–¹æ ¹åå·®ï¼ˆKabsch å¯¹é½ï¼‰
- **PCA**ï¼šä¸»æˆåˆ†åˆ†æï¼ˆç›¸å…³ç³»æ•°çŸ©é˜µï¼Œç´¯è®¡æ–¹å·®é˜ˆå€¼ï¼‰
- **ç»¼åˆå‘é‡**ï¼š[Z-score èƒ½é‡, PCA åˆ†é‡]ï¼Œç»„é—´ç¼©æ”¾

### æ™ºèƒ½é‡‡æ ·ç®—æ³•
- **Power Mean é‡‡æ ·**ï¼šå¹‚å¹³å‡è·ç¦»æœ€å¤§åŒ–è´ªå¿ƒé‡‡æ ·
- **é‡‡æ ·å¤ç”¨**ï¼šåŸºäºå“ˆå¸Œåˆ¤å®šï¼Œæ— çŠ¶æ€ç®¡ç†

### çƒ­æ›´æ–°ä¸æ–­ç‚¹ç»­ç®—
- **è¿›åº¦è·Ÿè¸ª**ï¼šè‡ªåŠ¨è®°å½•å·²å®Œæˆç³»ç»Ÿï¼Œé¿å…é‡å¤è®¡ç®—
- **å¢é‡ä¿å­˜**ï¼šè¾¹è®¡ç®—è¾¹å†™å…¥ï¼Œæ”¯æŒå®æ—¶æ•°æ®æŒä¹…åŒ–
- **æ™ºèƒ½æ£€æµ‹**ï¼šç¨‹åºé‡å¯æ—¶è‡ªåŠ¨æ£€æµ‹å¹¶è·³è¿‡å·²å¤„ç†ç³»ç»Ÿ
- **æ•°æ®å®Œæ•´æ€§**ï¼šç¡®ä¿ç¨‹åºä¸­æ–­æ—¶æ•°æ®ä¸ä¸¢å¤±

### é‡‡æ ·æ–¹æ³•å¯¹æ¯”
- **æ™ºèƒ½é‡‡æ ·**ï¼šPower Mean è´ªå¿ƒç®—æ³•
- **éšæœºé‡‡æ ·**ï¼šå¤šæ¬¡éšæœºè¯•éªŒ
- **å‡åŒ€é‡‡æ ·**ï¼šç­‰é—´éš”é‡‡æ ·
- **è¯„ä¼°æŒ‡æ ‡**ï¼šANNDã€MPDã€Coverage Ratioã€JS Divergenceã€RMSD ç­‰

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬å·¥ä½œæµç¨‹
```bash
# 1. ä¸»åˆ†æ
python main_abacus_analyser.py -r 0.05 -p -0.5 -v 0.90 -w 4

# 2. ç›¸å…³æ€§åˆ†æ
python main_correlation_analyser.py

# 3. æŸ¥çœ‹ç»“æœ
ls analysis_results/run_r0.1_p-0.5_v0.9/
```

### é«˜çº§ç”¨æ³•
```bash
# æŒ‡å®šå¤šä¸ªæœç´¢è·¯å¾„
python main_abacus_analyser.py -s /data/exp1 /data/exp2

# é«˜ç²¾åº¦åˆ†æ
python main_abacus_analyser.py -r 0.02 -v 0.95

# å¿«é€Ÿé¢„è§ˆ
python main_abacus_analyser.py -r 0.10 -v 0.85

# å¼ºåˆ¶é‡æ–°è®¡ç®—
python main_abacus_analyser.py -f

# ä»…è¿›è¡Œç›¸å…³æ€§åˆ†æ
python main_abacus_analyser.py -sc false

# ä»…è¿›è¡Œé‡‡æ ·å¯¹æ¯”
python main_abacus_analyser.py -c false

# è‡ªå®šä¹‰ç›¸å…³æ€§åˆ†æè¾“å…¥
python main_correlation_analyser.py -i custom.csv -o custom_results
```

### æ–­ç‚¹ç»­ç®—
```bash
# é¦–æ¬¡è¿è¡Œ
python main_abacus_analyser.py -r 0.05 -p -0.5 -v 0.90

# ç¨‹åºä¸­æ–­åç»§ç»­ï¼ˆè‡ªåŠ¨æ£€æµ‹è¿›åº¦ï¼‰
python main_abacus_analyser.py -r 0.05 -p -0.5 -v 0.90

# å¼ºåˆ¶é‡æ–°è®¡ç®—æ‰€æœ‰ç³»ç»Ÿ
python main_abacus_analyser.py -r 0.05 -p -0.5 -v 0.90 -f
```

### é‡‡æ ·æ–¹æ³•å¯¹æ¯”
```bash
# å¯¹æ¯”é‡‡æ ·æ–¹æ³•
python sampling_compare_demo.py

# æŒ‡å®šç»“æœç›®å½•
python sampling_compare_demo.py --result_dir /path/to/analysis_results/run_r0.1_p-0.5_v0.9
```

---

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
- **é‡‡æ ·æ¯”è¾ƒç»“æœæ˜¾ç¤º NaN**ï¼šæ•°æ®ä¸è¶³æˆ–æ•°å€¼å¼‚å¸¸
- **éšæœºé‡‡æ ·æ ‡å‡†å·®å¤§**ï¼šå±æ­£å¸¸ï¼Œè¯´æ˜æ™ºèƒ½é‡‡æ ·æ›´ç¨³å¥
- **é‡‡æ ·æ¯”è¾ƒæ…¢**ï¼šå› éœ€å¤šè½®éšæœºé‡‡æ ·ï¼Œå¯å‡å°‘è½®æ•°æˆ–åˆ†æéƒ¨åˆ†ç³»ç»Ÿ
- **F å€¼/p å€¼æ˜¾ç¤º NaN**ï¼šæ ·æœ¬é‡ä¸è¶³ï¼ŒANOVA æ— æ³•è®¡ç®—
- **åˆ†æé€Ÿåº¦æ…¢**ï¼šå¯å¢åŠ é‡‡æ ·æ¯”ä¾‹ (-r)ã€é™ä½ PCA é˜ˆå€¼ (-v)ã€å¢åŠ è¿›ç¨‹æ•° (-w)
- **å†…å­˜ä¸è¶³**ï¼šé™ä½é‡‡æ ·æ¯”ä¾‹æˆ–ä½¿ç”¨å•è¿›ç¨‹ (-w 1)
- **æ‰¾ä¸åˆ°ç³»ç»Ÿç›®å½•**ï¼šæ£€æŸ¥ç›®å½•å‘½åæ ¼å¼

### æ–­ç‚¹ç»­ç®—ç›¸å…³
- **ç¨‹åºä¸­æ–­åå¦‚ä½•ç»­ç®—**ï¼šç›´æ¥é‡æ–°è¿è¡Œç›¸åŒå‘½ä»¤ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹è¿›åº¦
- **å¼ºåˆ¶é‡æ–°è®¡ç®—**ï¼šä½¿ç”¨ `-f` å‚æ•°å¿½ç•¥å·²æœ‰è¿›åº¦
- **è¿›åº¦æ–‡ä»¶æŸå**ï¼šåˆ é™¤ `progress.json` æ–‡ä»¶é‡æ–°å¼€å§‹

---

## ğŸ“ˆ æ›´æ–°æ—¥å¿—

### 2025-09
- âœ¨ **DeepMD å¯¼å‡ºé»˜è®¤åŒ–**ï¼šæ¯ä¸ªä½“ç³»åˆ†æå®Œæˆåè‡ªåŠ¨å¯¼å‡º DeepMD æ•°æ®
- ğŸ› **é‡‡æ ·å¯¹æ¯”ä¿®å¤**ï¼šä¿®å¤æ ‡å‡†å·®è®¡ç®—é”™è¯¯ï¼Œä¼˜åŒ–æŒ‡æ ‡è®¡ç®—
- âš¡ **å¹¶è¡Œæ€§èƒ½ä¼˜åŒ–**ï¼šæå‡å¤šæ ¸åˆ©ç”¨ç‡å’Œè´Ÿè½½å‡è¡¡
- ğŸ”§ **å‘½ä»¤è¡Œå‚æ•°å®Œå–„**ï¼šé‡æ„å‚æ•°ï¼Œæ”¯æŒçµæ´»é…ç½®
- ğŸ“¦ **åŒ…ç»“æ„æ›´æ–°**ï¼šå®Œå–„æ¨¡å—åŒ–è®¾è®¡

### 2025-08
- ğŸ”¥ **çƒ­æ›´æ–°ä¸æ–­ç‚¹ç»­ç®—**ï¼šå®ç°è¾¹è®¡ç®—è¾¹å†™å…¥ï¼Œæ”¯æŒç¨‹åºä¸­æ–­åè‡ªåŠ¨ç»­ç®—
- ğŸ“Š **å¢é‡ä¿å­˜æœºåˆ¶**ï¼šCSV/JSON æ–‡ä»¶æ”¯æŒè¿½åŠ å†™å…¥ï¼Œå®æ—¶æ•°æ®æŒä¹…åŒ–
- ğŸ“ **è¿›åº¦è·Ÿè¸ªç³»ç»Ÿ**ï¼šè‡ªåŠ¨è®°å½•å·²å®Œæˆç³»ç»Ÿï¼Œæ”¯æŒæ™ºèƒ½è·³è¿‡
- ğŸ’¾ **æ•°æ®å®Œæ•´æ€§ä¿è¯**ï¼šç¡®ä¿ç¨‹åºä¸­æ–­æ—¶æ•°æ®ä¸ä¸¢å¤±
- ğŸ”„ **DeepMD å¯¼å‡ºä¼˜åŒ–**ï¼šæ”¯æŒæ£€æµ‹å·²æœ‰æ•°æ®é›†ï¼Œé¿å…é‡å¤å¯¼å‡º

### 2025-08 æ—©æœŸ
- ğŸ¯ **æ™ºèƒ½é‡‡æ ·ç®—æ³•**ï¼šPower Mean è´ªå¿ƒé‡‡æ ·ï¼Œæ˜¾è‘—æå‡é‡‡æ ·è´¨é‡
- ğŸ“Š **å¤šæ ·æ€§æŒ‡æ ‡ä½“ç³»**ï¼šANNDã€MPDã€Coverage Ratioã€JS Divergence ç­‰
- ğŸ”— **ç›¸å…³æ€§åˆ†æ**ï¼šæ¸©åº¦ã€æ„è±¡ä¸å¤šæ ·æ€§æŒ‡æ ‡çš„ç»Ÿè®¡ç›¸å…³æ€§åˆ†æ
- âš–ï¸ **é‡‡æ ·æ–¹æ³•å¯¹æ¯”**ï¼šæ™ºèƒ½é‡‡æ ·ã€éšæœºé‡‡æ ·ã€å‡åŒ€é‡‡æ ·æ€§èƒ½å¯¹æ¯”
- ğŸš€ **æ‰¹é‡å¹¶è¡Œå¤„ç†**ï¼šè‡ªåŠ¨å‘ç°å¤šä¸ªç³»ç»Ÿï¼Œå¤šè¿›ç¨‹å¹¶è¡Œåˆ†æ
- ğŸ“ **å‚æ•°éš”ç¦»è¾“å‡º**ï¼šè¾“å‡ºç›®å½•è‡ªåŠ¨æŒ‰å‚æ•°ç»„åˆå‘½å
- ğŸ’¾ **å¢é‡ä¿å­˜**ï¼šè¾¹è®¡ç®—è¾¹å†™å…¥ï¼Œæ”¯æŒå®æ—¶æ•°æ®æŒä¹…åŒ–

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ï¼š`git checkout -b feature/your-feature`
3. æäº¤æ›´æ”¹ï¼š`git commit -am 'Add new feature'`
4. æ¨é€åˆ†æ”¯ï¼š`git push origin feature/your-feature`
5. åˆ›å»º Pull Request

---

**Made with â¤ï¸ for the ABACUS community**
